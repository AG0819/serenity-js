
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Making the tests speak for themselves Â· Serenity/JS Handbook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        <meta name="author" content="Jan Molak">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../website-1484186722346.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../scenarios/screenplay-pattern.html" />
    
    
    <link rel="prev" href="writing-what-you-would-like-to-read.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Serenity/JS
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../introduction.html">
            
                <a href="../introduction.html">
            
                    
                    Introduction (video)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    From scripts to serenity (tutorial)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="speaking-the-right-language.html">
            
                <a href="speaking-the-right-language.html">
            
                    
                    Speaking the right language
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="writing-what-you-would-like-to-read.html">
            
                <a href="writing-what-you-would-like-to-read.html">
            
                    
                    Writing what you'd like to read
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2.3" data-path="making-the-tests-speak-for-themselves.html">
            
                <a href="making-the-tests-speak-for-themselves.html">
            
                    
                    Making the tests speak for themselves
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Writing Scenarios</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../scenarios/screenplay-pattern.html">
            
                <a href="../scenarios/screenplay-pattern.html">
            
                    
                    The Screenplay Pattern
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../license.html">
            
                <a href="../license.html">
            
                    
                    License
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../support.html">
            
                <a href="../support.html">
            
                    
                    Support
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Making the tests speak for themselves</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="from-scripts-to-serenity-making-the-tests-speak-for-themselves"><a name="from-scripts-to-serenity-making-the-tests-speak-for-themselves" class="plugin-anchor" href="#from-scripts-to-serenity-making-the-tests-speak-for-themselves"><i class="fa fa-link" aria-hidden="true"></i></a>From Scripts to Serenity: Making the tests speak for themselves</h1>
<p>In the <a href="writing-what-you-would-like-to-read.html">last tutorial</a>
we looked at the basics of writing acceptance tests that are focused, readable and free of
<a href="https://en.wikipedia.org/wiki/No_Silver_Bullet" target="_blank">accidental complexity</a>.
Those characteristics make even the most sophisticated test suites easy to understand, maintain and extend.
We&apos;ve also introduced the concepts behind the <a href="../scenarios/screenplay-pattern.html">Screenplay Pattern</a>,
an innovative new way of designing automated test systems.</p>
<p>In this article, we&apos;ll look at ways of making the results of the tests visible and accessible
to everyone on the team. Including the guys sponsoring our projects.</p>
<h2 id="recording-the-interactions"><a name="recording-the-interactions" class="plugin-anchor" href="#recording-the-interactions"><i class="fa fa-link" aria-hidden="true"></i></a>Recording the interactions</h2>
<p><img align="absmiddle" alt=":bulb:" class="emoji" src="../gitbook/gitbook-plugin-advanced-emoji/emojis/bulb.png" title=":bulb:"> <strong>PRO TIP:</strong> If you like learning by doing, you can continue to work on the code we wrote as part of
the <a href="writing-what-you-would-like-to-read.html">last tutorial</a>
or grab a fresh copy
from the <a href="https://github.com/jan-molak/serenity-js-getting-started/tree/1-first-scenario-implemented" target="_blank"><code>1-first-scenario-implemented</code></a>
branch.</p>
<pre><code>$&gt; git clone https://github.com/jan-molak/serenity-js-getting-started
$&gt; cd serenity-js-getting-started
$&gt; git checkout 1-first-scenario-implemented
</code></pre><p>To help Serenity/JS produce those narrative,
illustrated reports that anyone on the team can read and understand we first need to tell the library
a bit more about the life cycle of the scenarios we execute.</p>
<p>To do this, let&apos;s register the Serenity/JS Notifier in the <code>features/cucumber.hooks.ts</code>:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// features/cucumber.hooks.ts</span>

<span class="hljs-keyword">import</span> { protractor } from <span class="hljs-string">&apos;protractor&apos;</span>;
<span class="hljs-keyword">import</span> * as serenity from <span class="hljs-string">&apos;serenity-js/lib/serenity-cucumber&apos;</span>;

<span class="hljs-keyword">export</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.registerListener(serenity.scenarioLifeCycleNotifier());

    serenity.synchronise(<span class="hljs-keyword">this</span>, protractor.browser.driver.controlFlow());
};
</code></pre>
<p>With the Notifier in place, we now need something to receive the notifications and produce the report.
That&apos;s the role of the <code>SerenityProtractorPlugin</code>, which we can register in the Protractor configuration file:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// protractor.conf.js</span>

exports.config = {

    <span class="hljs-comment">// ...</span>

    plugins: [{
        path: <span class="hljs-string">&apos;node_modules/serenity-js/lib/serenity-protractor/plugin&apos;</span>
    }],

    <span class="hljs-comment">// ...</span>
};
</code></pre>
<p>When you run the tests again:</p>
<pre><code>$&gt; npm test
</code></pre><p>you&apos;ll notice that a new directory was created, with a JSON file in it:</p>
<pre><code>$&gt; ls target/site/serenity

704ff39d93ac1503afb0ba8a5ad03c71.json
</code></pre><p>Serenity/JS produces one JSON file per each test scenario executed.
Those JSON files are then analysed and aggregated by Serenity BDD in a separate step
to produce a HTML report. We&apos;ll look into the details of this process next.</p>
<h2 id="from-json-to-html"><a name="from-json-to-html" class="plugin-anchor" href="#from-json-to-html"><i class="fa fa-link" aria-hidden="true"></i></a>From JSON to HTML</h2>
<p>The HTML report is much more than just a sum of its parts.
The aggregate contains of course the detailed results of each test scenario,
but it can also contain information about the capabilities and features of your system that the tests have covered
and more importantly - the capabilities and features that the tests have not covered yet.</p>
<p>Since the HTML report presents a much richer perspective on the test results,
its generation is more demanding computationally.
For this reason, it happens separately from the test execution phase.
However, there are other practical advantages on top the positive performance implications of this design:</p>
<ol>
<li>Since the JSON reports produced by Serenity/JS are compatible with the ones produced
by <a href="http://serenity-bdd.info/" target="_blank">Serenity BDD for Java</a>, you can have Serenity/JS and Serenity BDD produce the intermediate
JSON reports independently and then aggregate them together to have a single report covering several projects</li>
<li>Because Serenity/JS produces a JSON file per test scenario, you can shard the execution of tests to multiple
servers, collect the intermediate reports and aggregate them at a later stage
of a <a href="https://en.wikipedia.org/wiki/Continuous_delivery" target="_blank">Continuous Delivery pipeline</a></li>
</ol>
<h3 id="managing-dependencies"><a name="managing-dependencies" class="plugin-anchor" href="#managing-dependencies"><i class="fa fa-link" aria-hidden="true"></i></a>Managing dependencies</h3>
<p>The component responsible for analysing and aggregating the intermediate reports is Serenity BDD itself,
which is a Java library and therefore requires a <a href="https://java.com/en/download/" target="_blank">Java Runtime Environment</a> 7 or newer.</p>
<p>To verify that you have Java 7 or newer installed, run:</p>
<pre><code>$&gt; java -version

java version &quot;1.8.0_25&quot;
Java(TM) SE Runtime Environment (build 1.8.0_25-b17)
Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)
</code></pre><p>To make invoking a Java program from Node.js easier,
we&apos;ll need a new dependency - <a href="https://www.npmjs.com/package/serenity-cli" target="_blank"><code>serenity-cli</code></a>:</p>
<pre><code>$&gt; npm install serenity-cli --save-dev
</code></pre><p><img align="absmiddle" alt=":bulb:" class="emoji" src="../gitbook/gitbook-plugin-advanced-emoji/emojis/bulb.png" title=":bulb:"> <strong>PRO TIP:</strong> Even though <code>serenity-cli</code> is a command line program, we&apos;re installing it in the scope
of the current project rather than globally.
This way we can make the dependency on the package explicit and its version under control,
which wouldn&apos;t be possible with a <a href="https://docs.npmjs.com/cli/install" target="_blank">globally installed module</a>.</p>
<h3 id="scripting-the-installation"><a name="scripting-the-installation" class="plugin-anchor" href="#scripting-the-installation"><i class="fa fa-link" aria-hidden="true"></i></a>Scripting the installation</h3>
<p><code>serenity-cli</code> delegates all the analysis and aggregation work to the Serenity BDD <code>jar</code>,
which means that it needs to download it first.
The downloading of the <code>jar</code> is a one time process as the <code>jar</code> gets cached in the <code>node_modules</code> directory.
This behaviour is similar to how Protractor
<a href="https://github.com/angular/webdriver-manager" target="_blank">manages the WebDriver <code>jar</code></a>
as well as other browser-specific driver binaries, such as <a href="https://sites.google.com/a/chromium.org/chromedriver/" target="_blank"><code>chromedriver</code></a>.</p>
<p>To make sure that the <code>jar</code> is downloaded when needed, add <code>&quot;pretest&quot;: &quot;serenity update&quot;</code> to the <code>scripts</code>
section of the <code>package.json</code>:</p>
<pre><code class="lang-json"><span class="hljs-comment">// package.json</span>

<span class="hljs-comment">// ...</span>

  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;pretest&quot;</span>: <span class="hljs-string">&quot;serenity update&quot;</span>,

    <span class="hljs-comment">//...</span>
  },

<span class="hljs-comment">// ...</span>
</code></pre>
<p>The <code>pretest</code> is an <a href="https://docs.npmjs.com/misc/scripts" target="_blank">NPM script</a>, which will be invoked before the <code>npm test</code>
command is executed.</p>
<p>When you call <code>npm test</code> with the new script in place, you should see the output similar to the following:</p>
<pre><code>$&gt; npm test

info: Looks like you need the latest Serenity BDD CLI jar. Let me download it for you...
info: Downloaded to /Users/jan/serenity-js-getting-started/node_modules/serenity-cli/.cache/serenity-cli-0.0.1-rc.3-all.jar
</code></pre><h3 id="scripting-the-reporting"><a name="scripting-the-reporting" class="plugin-anchor" href="#scripting-the-reporting"><i class="fa fa-link" aria-hidden="true"></i></a>Scripting the reporting</h3>
<p>With the Serenity BDD CLI <code>jar</code> in place, we can now use it to produce the aggregated report. To do this, let&apos;s add
another NPM script - <code>&quot;report&quot;: &quot;serenity run&quot;</code>:</p>
<pre><code class="lang-json"><span class="hljs-comment">// package.json</span>

<span class="hljs-comment">// ...</span>

  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;pretest&quot;</span>: <span class="hljs-string">&quot;serenity update&quot;</span>,
    <span class="hljs-string">&quot;report&quot;</span>:  <span class="hljs-string">&quot;serenity run&quot;</span>,

    <span class="hljs-comment">//...</span>
  },

<span class="hljs-comment">// ...</span>
</code></pre>
<p>We can now execute both scripts in a sequence to see the HTML report we&apos;ve been waiting for:</p>
<pre><code>$&gt; npm test
</code></pre><pre><code>$&gt; npm run report
</code></pre><p><img align="absmiddle" alt=":bulb:" class="emoji" src="../gitbook/gitbook-plugin-advanced-emoji/emojis/bulb.png" title=":bulb:"> <strong>PRO TIP</strong>: As opposed to <code>test</code> and <code>pretest</code>, <code>report</code> is not a <a href="https://docs.npmjs.com/misc/scripts" target="_blank">standard NPM script</a>.
You can invoke any custom scripts using the <code>npm run &lt;script name&gt;</code> syntax, which is what we just did.</p>
<p>The result of executing the <code>npm run report</code> is a static HTML page, generated under <code>target/site/serenity</code>.
Inside that directory you&apos;ll notice the <code>index.html</code> file, which opened in a web browser should present a report similar
to the one below:</p>
<p><img src="images/first_report.png" alt="Serenity BDD Scenario Report with Interactions only"></p>
<h3 id="starting-fresh-each-time"><a name="starting-fresh-each-time" class="plugin-anchor" href="#starting-fresh-each-time"><i class="fa fa-link" aria-hidden="true"></i></a>Starting fresh each time</h3>
<p>In order to avoid having reports from previous test executions lying around, we need to make sure that
the <code>target</code> directory is empty before executing the suite.</p>
<p>To create the script that does it for us, install the <a href="https://www.npmjs.com/package/rimraf" target="_blank"><code>rimraf</code> module</a>:</p>
<pre><code>$&gt; npm install rimraf --save-dev
</code></pre><p>and define a <code>clean</code> script:</p>
<pre><code class="lang-json"><span class="hljs-comment">// package.json</span>

<span class="hljs-comment">// ...</span>

  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;clean&quot;</span>:   <span class="hljs-string">&quot;rimraf target&quot;</span>,
    <span class="hljs-string">&quot;pretest&quot;</span>: <span class="hljs-string">&quot;serenity update&quot;</span>,
    <span class="hljs-string">&quot;report&quot;</span>:  <span class="hljs-string">&quot;serenity run&quot;</span>,

    <span class="hljs-comment">//...</span>
  },

<span class="hljs-comment">// ...</span>
</code></pre>
<p>Running <code>npm run clean</code> removes the <code>target</code> directory.</p>
<h3 id="scripting-the-flow"><a name="scripting-the-flow" class="plugin-anchor" href="#scripting-the-flow"><i class="fa fa-link" aria-hidden="true"></i></a>Scripting the flow</h3>
<p>Right now we can:</p>
<ul>
<li>execute the test suite and produce the intermediary JSON reports - <code>npm test</code></li>
<li>analyse the individual reports and produce an aggregated HTML report - <code>npm run report</code></li>
<li>remove the <code>target</code> directory, storing both JSON and HTML files before each test suite run - <code>npm run clean</code></li>
</ul>
<p>It would be much easier if instead of calling three separate commands we could just call one.
Thankfully, the <a href="https://www.npmjs.com/package/npm-failsafe" target="_blank"><code>npm-failsafe</code></a> can help us with that:</p>
<pre><code>$&gt; npm install npm-failsafe --save-dev
</code></pre><p><img align="absmiddle" alt=":bulb:" class="emoji" src="../gitbook/gitbook-plugin-advanced-emoji/emojis/bulb.png" title=":bulb:"> <strong>PRO TIP</strong>: We&apos;re using the <code>npm-failsafe</code> module instead of the more traditional <code>&amp;&amp;</code> and <code>||</code> operators.
Chaining the scripts using <code>script-1 &amp;&amp; script-2</code> syntax won&apos;t execute <code>script-2</code> should <code>script-1</code>
fail - so we won&apos;t get the test report when a test fails, which is exactly when we need it the most.
Using <code>script-1 || script-2</code> executes both scripts even if the first one fails,
but returns an <a href="http://tldp.org/LDP/abs/html/exit-status.html" target="_blank">exit code of success</a> even when the tests fail,
which confuses <a href="https://en.wikipedia.org/wiki/Continuous_integration" target="_blank">Continuous Integration</a> servers.</p>
<p>With <code>npm-failsafe</code> installed we can modify our <code>scripts</code> a bit:</p>
<pre><code class="lang-json"><span class="hljs-comment">// package.json</span>

<span class="hljs-comment">// ...</span>

  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;clean&quot;</span>:   <span class="hljs-string">&quot;rimraf target&quot;</span>,
    <span class="hljs-string">&quot;pretest&quot;</span>: <span class="hljs-string">&quot;serenity update&quot;</span>,
    <span class="hljs-string">&quot;report&quot;</span>:  <span class="hljs-string">&quot;serenity run&quot;</span>,
    <span class="hljs-string">&quot;test&quot;</span>:    <span class="hljs-string">&quot;failsafe clean protractor report&quot;</span>,

    <span class="hljs-comment">//...</span>
  },

<span class="hljs-comment">// ...</span>
</code></pre>
<p>Now running <code>npm test</code> will:</p>
<ul>
<li>download the Serenity BDD CLI <code>jar</code> and cache it if it&apos;s needed</li>
<li>clean the <code>target</code> directory</li>
<li>execute the tests</li>
<li>generate the HTML report</li>
</ul>
<h2 id="narrative-reports"><a name="narrative-reports" class="plugin-anchor" href="#narrative-reports"><i class="fa fa-link" aria-hidden="true"></i></a>Narrative reports</h2>
<p>Opening the HTML report and navigating to the details of our test scenario should present a view similar to the one below:</p>
<p><img src="images/scenario_report_interactions.png" alt="First Serenity BDD Report"></p>
<p>As you can see, each Cucumber step is presented together with all the interactions that have contributed to making it happen.
That&apos;s very useful, but the Interactions are pretty low-level and all speak using the vocabulary
of the solution domain (&quot;clicking buttons&quot; and &quot;entering values into fields&quot;) rather than the business domain
(&quot;adding items to the list&quot;, &quot;paying with a default credit card&quot; and so on). Let&apos;s improve that now.</p>
<p>Head back to the <code>Start</code> Task we have created as part of our last tutorial and add a <code>@step</code> annotation,
giving the Task a more descriptive name:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/screenplay/tasks/start.ts</span>

<span class="hljs-keyword">import</span> { PerformsTasks, Task } from <span class="hljs-string">&apos;serenity-js/lib/screenplay&apos;</span>;
<span class="hljs-keyword">import</span> { Open, step } from <span class="hljs-string">&apos;serenity-js/lib/screenplay-protractor&apos;</span>;     <span class="hljs-comment">// imports the @step</span>

<span class="hljs-keyword">import</span> { AddATodoItem } from <span class="hljs-string">&apos;./add_a_todo_item&apos;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> Start <span class="hljs-keyword">implements</span> Task {

    <span class="hljs-keyword">static</span> withATodoListContaining(items: <span class="hljs-built_in">string</span>[]) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Start(items);
    }

    @step(<span class="hljs-string">&apos;{0} starts with a Todo List containing #items&apos;</span>)      <span class="hljs-comment">// Gives the Task a more descriptive name</span>
    performAs(actor: PerformsTasks): PromiseLike&lt;<span class="hljs-built_in">void</span>&gt; {
        <span class="hljs-keyword">return</span> actor.attemptsTo(
            Open.browserOn(<span class="hljs-string">&apos;/examples/angularjs/&apos;</span>),
            ...this.addAll(<span class="hljs-keyword">this</span>.items)
        );
    }

    <span class="hljs-keyword">constructor</span>(private items: string[]) {
    }

    <span class="hljs-keyword">private</span> addAll(items: <span class="hljs-built_in">string</span>[]): Task[] {
        <span class="hljs-keyword">return</span> items.map(item =&gt; AddATodoItem.called(item));
    }
}
</code></pre>
<p><img align="absmiddle" alt=":bulb:" class="emoji" src="../gitbook/gitbook-plugin-advanced-emoji/emojis/bulb.png" title=":bulb:"> <strong>PRO TIP</strong>: <code>@step</code> annotation can process tokens and those can be defined as:</p>
<ul>
<li><code>{0}</code>, where <code>0</code> means the 0-th argument the <code>performAs</code> method was invoked with - the <code>actor</code> in our case</li>
<li><code>#member</code>, where <code>member</code> means any private or public field or method of the Task object - here it&apos;s the <code>items</code> field</li>
</ul>
<p>Now, repeat the process with the <code>AddATodoItem</code> task:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/screenplay/tasks/add_a_todo_item.ts</span>

<span class="hljs-keyword">import</span> { PerformsTasks, Task } from <span class="hljs-string">&apos;serenity-js/lib/screenplay&apos;</span>;
<span class="hljs-keyword">import</span> { Enter, step } from <span class="hljs-string">&apos;serenity-js/lib/screenplay-protractor&apos;</span>;    <span class="hljs-comment">// imports the @step</span>

<span class="hljs-keyword">import</span> { protractor } from <span class="hljs-string">&apos;protractor&apos;</span>;

<span class="hljs-keyword">import</span> { TodoList } from <span class="hljs-string">&apos;../ui/todo_list&apos;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AddATodoItem <span class="hljs-keyword">implements</span> Task {

    <span class="hljs-keyword">static</span> called(itemName: <span class="hljs-built_in">string</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AddATodoItem(itemName);
    }

    @step(<span class="hljs-string">&apos;{0} adds a Todo Item called #itemName&apos;</span>)              <span class="hljs-comment">// Gives the Task a more descriptive name</span>
    performAs(actor: PerformsTasks): PromiseLike&lt;<span class="hljs-built_in">void</span>&gt; {
        <span class="hljs-keyword">return</span> actor.attemptsTo(
            Enter.theValue(<span class="hljs-keyword">this</span>.itemName)
                .into(TodoList.What_Needs_To_Be_Done)
                .thenHit(protractor.Key.ENTER)
        );
    }

    <span class="hljs-keyword">constructor</span>(private itemName: string) {
    }
}
</code></pre>
<p>And run the test suite again to see that the scenario report now also mentions all the business-level tasks:</p>
<pre><code>$&gt; npm test
</code></pre><p><img src="images/scenario_report_tasks.png" alt="Serenity BDD Scenario Report with Business Tasks"></p>
<h2 id="an-image-is-worth-a-thousand-words"><a name="an-image-is-worth-a-thousand-words" class="plugin-anchor" href="#an-image-is-worth-a-thousand-words"><i class="fa fa-link" aria-hidden="true"></i></a>An image is worth a thousand words</h2>
<p>In the beginning I promised that the reports will not only be narrative but also illustrated.</p>
<p>The design of the Serenity/JS library uses a <a href="http://www.extremeprogramming.org/rules/metaphor.html" target="_blank">system metaphor</a>
of a stage performance (the name of the <a href="../scenarios/screenplay-pattern.html">Screenplay Pattern</a> is a prime example of that).
This means that in order to add pictures to the reports we need to invite a Photographer to join the Stage Crew.</p>
<p>To do this, change the configuration of the Serenity Protractor Plugin to assign the Stage Crew:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// protractor.conf.js</span>

<span class="hljs-keyword">var</span> crew = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;serenity-js/lib/stage_crew&apos;</span>);

<span class="hljs-comment">// ...</span>

exports.config = {

<span class="hljs-comment">// ...</span>

    plugins: [{
        path: <span class="hljs-string">&apos;node_modules/serenity-js/lib/serenity-protractor/plugin&apos;</span>,
        crew: [
            crew.jsonReporter(),
            crew.photographer()
        ]
    }],

<span class="hljs-comment">// ...</span>
};
</code></pre>
<p>A Photographer will take a photo of whichever Actor is in the Spotlight, as soon as the Actor performs an activity
of interest to the Photographer.</p>
<p>In order to have the Actor in a Spotlight though, we need to have the Stage first,
so let&apos;s make the following changes to the <code>todo_user.steps.ts</code>:</p>
<pre><code class="lang-typescript"># features/step_definitions/todo_user.steps.ts

<span class="hljs-keyword">import</span> { Serenity } from <span class="hljs-string">&apos;serenity-js&apos;</span>;
<span class="hljs-keyword">import</span> { Actor, BrowseTheWeb } from <span class="hljs-string">&apos;serenity-js/lib/screenplay-protractor&apos;</span>;
<span class="hljs-keyword">import</span> { protractor } from <span class="hljs-string">&apos;protractor&apos;</span>;

<span class="hljs-keyword">import</span> { Start } from <span class="hljs-string">&apos;../../src/screenplay/tasks/start&apos;</span>;
<span class="hljs-keyword">import</span> { AddATodoItem } from <span class="hljs-string">&apos;../../src/screenplay/tasks/add_a_todo_item&apos;</span>;
<span class="hljs-keyword">import</span> { TodoListItems } from <span class="hljs-string">&apos;../../src/screenplay/questions/todo_list_items&apos;</span>;

<span class="hljs-keyword">import</span> { listOf } from <span class="hljs-string">&apos;../../src/text&apos;</span>;
<span class="hljs-keyword">import</span> { expect } from <span class="hljs-string">&apos;../../src/expect&apos;</span>;

<span class="hljs-keyword">export</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoUserSteps</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> stage = Serenity.callToStageFor({
        actor: (name) =&gt; Actor.named(name).whoCan(BrowseTheWeb.using(protractor.browser))
    });

    <span class="hljs-keyword">this</span>.Given(<span class="hljs-regexp">/^.*that (.*) has a todo list containing (.*)$/</span>, (name: <span class="hljs-built_in">string</span>, items: <span class="hljs-built_in">string</span>) =&gt; {
        <span class="hljs-keyword">return</span> stage.theActorCalled(name).attemptsTo(
            Start.withATodoListContaining(listOf(items))
        );
    });

    <span class="hljs-keyword">this</span>.When(<span class="hljs-regexp">/^s?he adds (.*?) to (?:his|her) list$/</span>, (itemName: <span class="hljs-built_in">string</span>) =&gt; {
        <span class="hljs-keyword">return</span> stage.theActorInTheSpotlight().attemptsTo(
            AddATodoItem.called(itemName)
        )
    });

    <span class="hljs-keyword">this</span>.Then(<span class="hljs-regexp">/^.* todo list should contain (.*?)$/</span>, (items: <span class="hljs-built_in">string</span>) =&gt; {
        <span class="hljs-keyword">return</span> expect(stage.theActorInTheSpotlight().toSee(TodoListItems.Displayed))
            .eventually.deep.equal(listOf(items))
    });
};
</code></pre>
<p>As you can see above, instead of instantiating the <code>Actor</code> directly, we delegate this job to the <code>Stage</code> class:</p>
<ul>
<li><code>stage.theActorCalled(name)</code> creates a new <code>Actor</code> via the
<code>(name) =&gt; Actor.named(name)...</code> function and remembers it
as the &quot;Actor in the Spotlight&quot;</li>
<li><code>stage.theActorInTheSpotlight()</code> retrieves the last active <code>Actor</code></li>
</ul>
<p>We&apos;ll look in detail into how the Stage works in the future tutorials when we talk about multi-actor testing.</p>
<p>For now, since we have both the Stage and the Stage Crew assigned to it, we can again run the tests:</p>
<pre><code>$&gt; npm test
</code></pre><p>This time however you should be able to see a screenshot accompanying each Interaction and Task:</p>
<p><img src="images/scenario_report_screenshots.png" alt="Serenity BDD Scenario Report with Screenshots"></p>
<h2 id="summary"><a name="summary" class="plugin-anchor" href="#summary"><i class="fa fa-link" aria-hidden="true"></i></a>Summary</h2>
<p>By organising the code of our automated acceptance testing system
to follow the <a href="../scenarios/screenplay-pattern.html">Screenplay Pattern</a>
and adding <code>@step</code> annotations to the business-level tasks, we managed to generate meaningful, narrative and illustrated
reports that can form part of the <a href="https://en.wikipedia.org/wiki/Specification_by_example" target="_blank">living documentation</a>
of our application and help facilitate better communication between the members of the project team.</p>
<hr>
<h3 id="your-feedback-matters"><a name="your-feedback-matters" class="plugin-anchor" href="#your-feedback-matters"><i class="fa fa-link" aria-hidden="true"></i></a>Your feedback matters!</h3>
<p>Please feel free to <a href="https://github.com/jan-molak/serenity-js/issues" target="_blank">suggest features and improvements</a>,
<a href="https://github.com/jan-molak/serenity-js/edit/master/from-scripts-to-serenity/making-the-tests-speak-for-themselves.md" target="_blank">correct any typos or broken links</a>
and get in touch on twitter <a href="https://twitter.com/JanMolak" target="_blank">@JanMolak</a> to let me know your thoughts!</p>
<p>If you find Serenity/JS useful, don&apos;t forget to give it a &#x2605; on github!</p>
<p><a class="github-button" href="https://github.com/jan-molak/serenity-js" data-icon="octicon-star" data-style="mega" data-count-href="/jan-molak/serenity-js/stargazers" data-count-api="/repos/jan-molak/serenity-js#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star jan-molak/serenity-js on GitHub" target="_blank">Star</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="writing-what-you-would-like-to-read.html" class="navigation navigation-prev " aria-label="Previous page: Writing what you'd like to read">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../scenarios/screenplay-pattern.html" class="navigation navigation-next " aria-label="Next page: The Screenplay Pattern">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Making the tests speak for themselves","level":"2.2.3","depth":2,"next":{"title":"The Screenplay Pattern","level":"3.1","depth":1,"path":"scenarios/screenplay-pattern.md","ref":"scenarios/screenplay-pattern.md","articles":[]},"previous":{"title":"Writing what you'd like to read","level":"2.2.2","depth":2,"path":"from-scripts-to-serenity/writing-what-you-would-like-to-read.md","ref":"from-scripts-to-serenity/writing-what-you-would-like-to-read.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors","advanced-emoji","include-codeblock","ga","styles-less","youtube"],"root":"./book","styles":{"website":"website-1484186722346.css"},"pluginsConfig":{"youtube":{},"styles-less":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-85788349-2"},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"Jan Molak","custom":{"scripts":["https://buttons.github.io/buttons.js"]},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"api_version":"0.0.1"},"title":"Serenity/JS Handbook","gitbook":"*","description":"A comprehensive reference manual and tutorials for Serenity/JS, a next generation automated testing library"},"file":{"path":"from-scripts-to-serenity/making-the-tests-speak-for-themselves.md","mtime":"2017-01-12T01:12:06.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-01-12T02:05:20.808Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        

    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    


<script type="text/javascript" src="https://buttons.github.io/buttons.js"></script>


    </body>
</html>

